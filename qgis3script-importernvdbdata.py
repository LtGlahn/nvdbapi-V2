# -*- coding: utf-8 -*-
"""
Script for å interaktivt legge til NVDB-vegnett og fagdata via python 
kommandolinje i QGIS. Se dokumentasjon på bruk av nvdbapi - funskjoner på
https://github.com/LtGlahn/nvdbapi-V2


Legg dette scriptet et sted hvor det er lettvint 
å finne fra QGIS. F.eks. C:/Users/<dittbrukernavn>. 

EKSEMPLER

#Vegnett europaveger Trondheim kommune
v = nvdbVegnett()")
v.addfilter_geo({ 'kommune' : 1601, 'vegreferanse' : 'E' })" ) 
nvdb2qgislag( v, 'Europaveger Trondheim', iface)") 

# Bomstasjoner
b = nvdbFagdata(45)")
nvdb2qgislag(b, 'Bomstasjoner', iface)")

# Søk etter fartsgrenser innenfor kartflaten, legg til 
f = nvdbFagdata(105)
nvdb2kart( f, iface)

"""

import sys
# import os 

# Endre stien til dit du har lastet ned biblioteket
# https://github.com/LtGlahn/nvdbapi-V2 
# nvdblibrary = 'C:/Data/test/github/nvdbapi-py'
nvdblibrary = '/home/jan/Documents/jobb/oskarholdeplass/nvdbapi-V2'

if not [ k for k in sys.path if 'nvdbapi-V2' in k]: 
    print( 'Føyer', nvdblibrary, 'til søkestien') 
    sys.path.append(nvdblibrary)

#####################

mywkt2 = "MULTILINESTRING Z ((265058.30005 7030312.8999 29, 265061 7030309.69971 29.3, 265065 7030304.6001 29.5, 265070.30005 7030297.5 29.9, 265075.69995 7030290.1001 30.3, 265079.8999 7030284.6001 30.4, 265086.5 7030276 30.7, 265092.80005 7030268.8999 30.7, 265098.30005 7030262.3999 30.8, 265103.19995 7030257.30029 30.9, 265105.53143 7030254.87895 30.94484, 265108.3999 7030251.8999 31, 265115.19995 7030245.30029 31, 265120.30005 7030240.6001 31.2, 265126.19995 7030235.30029 31.4, 265134.1001 7030228.19971 31.4, 265141.19995 7030222.19971 31.7, 265147.69995 7030216.6001 31.9, 265154.5 7030210.5 32, 265161.6001 7030204 32.2, 265171.30005 7030195.5 32.4, 265180.1001 7030187.3999 32.5, 265187.5 7030181.19971 32.5, 265195.6001 7030174.6001 32.7, 265202.6001 7030168.69971 32.8, 265211 7030161.3999 32.9, 265218.8999 7030154.19971 33.1, 265226.30005 7030147.5 33.1, 265233.3999 7030141.30029 33.2, 265243.30005 7030131.8999 33.4, 265247.69995 7030127.80029 33.5, 265251.5 7030124.30029 33.5, 265255.09998 7030120.59998 33.5), (265271.30005 7030060.69995 32.5, 265270.80005 7030054.80029 32.5, 265270.30005 7030048.80005 32.5, 265270.1001 7030042.5 32.8, 265269.3 7030035.9 33.1, 265268.3999 7030030.3999 33.5, 265268.05542 7030029.02161 33.64769), (265209.37 7029862.09 45.64, 265208 7029849.2998 46.4, 265207.19995 7029840 46.4, 265206.30005 7029830.3999 46.4, 265205.6001 7029823 46.3, 265204.6001 7029815 46.3, 265203.30005 7029806.6001 46.4, 265201 7029794.7002 46.4, 265199.1001 7029785.8999 46.3, 265196.80005 7029776.7998 46.3, 265193.69995 7029765.5 46.2, 265191.3999 7029756.6001 45.9, 265189.5 7029748 45.8, 265187.1001 7029737.8999 45.6, 265184.69995 7029727.3999 45.7, 265181.1001 7029710.2002 45.5, 265179.1001 7029699.5 45.7, 265176.5 7029688.3999 45.5, 265173.80005 7029676.7998 45.6, 265171.8999 7029668.2998 45.5, 265169.30005 7029656.6001 45.6, 265168.5 7029651.6001 45.7, 265168.1001 7029646.3999 45.8, 265167.8999 7029641 46, 265168.1001 7029634.1001 46, 265168.80005 7029628.6001 46, 265170.19995 7029623.2002 46, 265172.1001 7029617.1001 46, 265174.19995 7029610.7998 46, 265176.3999 7029605.2002 46.3, 265178.5 7029600.6001 46.2, 265180.80005 7029596.8999 46.1, 265183.6001 7029593.8999 46, 265186.6001 7029590.7998 46, 265191.19995 7029586.6001 45.9, 265194.8999 7029583.7998 45.9, 265199.3999 7029579.8999 46, 265204.69995 7029574.8999 46, 265211.1 7029568.3 45.9, 265214.69995 7029564 45.7, 265221.80005 7029556.7002 45.6, 265228.8999 7029550.2002 45.5, 265235.6001 7029543.3999 45.2, 265245.1 7029535.3 44.5, 265249.1001 7029532.1001 44.5, 265256.3999 7029526 44.3, 265262.8999 7029520.5 43.7, 265269.6001 7029515 43.4, 265276.6001 7029509.2002 43.1, 265281.19995 7029505.6001 42.9, 265286.80005 7029500.8999 43, 265292.19995 7029496.2998 43, 265298.19995 7029491.5 42.9, 265303.6001 7029486.6001 42.9, 265309.6001 7029481.3999 43, 265315.6001 7029476.5 43.1, 265321.8999 7029471.2998 43.2, 265328.1001 7029466.2002 43.5, 265336 7029459.2002 44, 265343.5 7029452.8999 44.7, 265349.5 7029447.7002 45, 265354.8999 7029443 45.8, 265361.19995 7029437.3999 46.6, 265367.19995 7029432.2998 46.9, 265372.19995 7029428.3999 47, 265375.8999 7029425.3999 47, 265380 7029422.7002 47.1, 265382.6001 7029421.1001 47.1, 265385.69995 7029419.5 47.1, 265388.5 7029418.1001 47, 265391.3999 7029417 47, 265394.5 7029415 47.1, 265399.5 7029413.3999 47.1, 265403.8999 7029412.2998 46.9, 265409.1001 7029411.6001 46.9, 265413.69995 7029411.2002 46.7, 265418.3999 7029410.7998 46.2, 265426.8999 7029411 45.8, 265436.5 7029411.7002 45.8, 265440.69995 7029412 45.8, 265447.5 7029412.5 45.7, 265453.30005 7029412.8999 45.8, 265461.80005 7029413.6001 45.8, 265465.69995 7029413.7998 45.8, 265469.3999 7029413.7002 45.8, 265472 7029413.3999 45.9, 265475.8999 7029412.8999 45.9, 265480.80005 7029412.1001 45.9, 265482.8999 7029411.7002 46, 265486.69995 7029410.3999 46, 265490.19995 7029409.2998 46, 265494.69995 7029407.1001 45.8, 265499.5 7029405 45.5, 265502.69995 7029402.7002 45.2, 265509.5 7029398.1001 44.6, 265520.1001 7029390.1001 43.8, 265525.69995 7029385.6001 43.4, 265529.80005 7029382.2002 43.4, 265533 7029380.1001 43.3, 265536.5 7029377.7998 43.2, 265540.1001 7029375.7002 43.1, 265546.1001 7029373.3999 43.2, 265551.6001 7029371.3999 43.2, 265555.8999 7029370.2998 43.4, 265560.6001 7029369.3999 43.7, 265566.8999 7029368.5 44.1, 265571.1001 7029368.2998 44.5, 265579.6001 7029368 45, 265585.1001 7029368 45.2, 265587.6001 7029368.3999 45.3, 265591.8999 7029369 45.5, 265597 7029370 45.7, 265601.3999 7029371.2998 45.9, 265609.1001 7029374 46.2, 265612.69995 7029375.1001 46.3, 265621.80005 7029377.8999 46.4, 265628.80005 7029380 46.4, 265635.8999 7029382.3999 46.4, 265639.30005 7029384 46.4, 265643.6001 7029385.8999 46.4, 265647.30005 7029388.6001 46.5, 265650.5 7029391.2002 46.6, 265652.69995 7029393.5 46.7, 265655.69995 7029398.1001 46.8, 265658.3999 7029403.3999 46.9, 265663 7029412 46.9, 265666.80005 7029418.2002 47.2, 265669.19995 7029421.2998 47.5, 265671.80005 7029423.8999 47.6, 265673.69995 7029425.7998 47.8, 265676 7029427.1001 47.9, 265678.6001 7029428.3999 48, 265682.69995 7029429.7002 48.2, 265687.80005 7029431.1001 48.3, 265693.69995 7029431.7998 48.4, 265702.3999 7029432.8999 48.7, 265714.5 7029434.6001 48.8, 265719.30005 7029435.1001 49.1, 265726.80005 7029436.1001 49.2, 265730 7029436.2002 49.2, 265733.30005 7029436.3999 49.2, 265735.69995 7029436.2998 49.2, 265738.69995 7029436.2002 49.1, 265743.19995 7029435.8999 49, 265748.1001 7029435.2002 48.4, 265753.5 7029434.6001 48, 265763.8999 7029433.6001 47.6, 265773.6001 7029432.2002 47.4, 265786.69995 7029430.1001 47.3, 265795.5 7029428.6001 47.3, 265804.30005 7029427.3999 47.4, 265814.19995 7029425.7002 47.5, 265823.30005 7029423.6001 47.6, 265832.4 7029421.3 47.8, 265838.69995 7029419.8999 47.4, 265848.30005 7029416.8999 47.5, 265858.6001 7029413.2002 47.4, 265862 7029411.7002 47.4, 265864.80005 7029410.5 47.4, 265866.69995 7029409.5 47.4, 265868.8999 7029408.2998 47.3, 265870.80005 7029407.7002 47.3, 265872.80005 7029407.1001 47.3, 265876.3999 7029405.8999 47.3, 265881.69995 7029404.6001 47.3, 265887 7029403 47.7, 265892 7029401.9 48.3, 265895.1001 7029401 48.5, 265898.3999 7029400.2002 48.9, 265900.69995 7029399.5 49.1, 265903.30005 7029398.7002 49.4, 265905.69995 7029397.7002 49.6, 265909.8999 7029396.2998 49.3, 265913.30005 7029395.2998 49.3, 265917.6001 7029393.8999 49, 265921.6001 7029392.8999 48.7, 265924.69995 7029392.2998 48.5, 265927.8999 7029391.8999 48.2, 265931.19995 7029391.7002 48.1, 265933.8999 7029392 48, 265936 7029392.6001 48, 265938.3999 7029394 47.6, 265941.30005 7029396 47.3, 265944.1001 7029398.3999 47, 265948.30005 7029402.5 46.3, 265951.8999 7029406.2998 45.6, 265955.5 7029409.8999 45, 265958.80005 7029413.2998 44.6, 265961.19995 7029415.7002 44.3, 265963.59998 7029417.3999 44.1, 265966.30005 7029419.8999 43.6, 265968.69995 7029422 43.3, 265971.59998 7029423.8999 43.1, 265973.40002 7029425.1001 43, 265977.09998 7029426.8999 42.8, 265981 7029428.3999 42.7, 265984.40002 7029429.6001 42.6, 265989.19995 7029430.8999 42.6, 265993.59998 7029431.7998 42.6, 265997.69995 7029432.6001 42.6, 265999 7029432.8999 42.5, 266002.59998 7029433.6001 42.5, 266008.19995 7029434.1001 42.7, 266014 7029434.5 43, 266018.80005 7029434.8999 43.2, 266024 7029435 43.7, 266029.80005 7029435 44.1, 266033.59998 7029434.7998 44.3, 266039.5 7029434.6001 45, 266045.59998 7029434.2002 45.4, 266050.80005 7029433.7998 45.8, 266055.59998 7029433.3999 46.3, 266062.30005 7029432.7998 46.6, 266066.19995 7029432.2998 47.1, 266072.80005 7029431.8999 47.5, 266077.69995 7029431.7002 48, 266083.30005 7029431.7998 48.5, 266088.09998 7029432.1001 48.9, 266092.19995 7029432.7998 49.1, 266096.59998 7029433.3999 49.4, 266099.90002 7029434.2002 49.4, 266102 7029434.7002 49.6, 266103.69995 7029435.2998 49.9, 266106.69995 7029436.2998 50.3, 266111.90002 7029437.6001 50.9, 266117.09998 7029439.2002 51.4, 266122.80005 7029440.7998 51.9, 266127.90002 7029442.2998 52.2, 266133.30005 7029443.5 52.7, 266140 7029445 53, 266146.69995 7029445.8999 53.5, 266152.5 7029446.8999 53.9, 266158.5 7029447.3999 53.9, 266164.59998 7029448 54.3, 266170.5 7029448.3999 54.8, 266175.5 7029448.7002 54.9, 266179.59998 7029448.7998 55.1, 266183 7029448.7998 55.2, 266191.7 7029448.5 55.5, 266195 7029448.7998 55.4, 266200.5 7029448.7998 55.6, 266207 7029448.40039 55.7, 266214.30005 7029447.7002 56, 266222.40002 7029447.2002 56.1, 266230.90002 7029446.40039 56.5, 266236.19995 7029446.09961 56.7, 266241.19995 7029445.90039 57, 266244.59998 7029446.2002 57, 266247.09998 7029446.59961 57.2, 266249.49268 7029448.24316 57.5, 266251.60498 7029449.60059 57.7, 266254.62244 7029453.57324 58, 266256.73462 7029455.88672 58.2))"
mywkt = 'MULTILINESTRING ((265058.30005 7030312.8999, 265061 7030309.69971), (265065 7030304.6001, 265070.30005 7030297.5, 265075.69995 7030290.1001))'


mineobj = [ { 'egenskaper' : [1, 'asdff'], 'wktgeom' : 'POINT ( 274539 7042095)'}, 
            { 'egenskaper' : [2, 'fin linje'], 'wktgeom' : 'LINESTRING (274539 7042095, 274539 7042195)'},
            { 'egenskaper' : [3, 'hehe'], 'wktgeom' : 'POINT ( 274549 7042155)'},
            { 'egenskaper' : [4, 'fin linje'], 'wktgeom' : 'LINESTRING (274509 7042095, 274509 7042195)'},
            { 'egenskaper' : [5, 'Ekte fartsgrense'], 'wktgeom' : mywkt }, 
            { 'egenskaper' : [3, 'hehe'], 'wktgeom' : 'POINT ( 274529 7042165)'},
            ]

mittpunkt2d =  { 'egenskaper' : [1, 'asdff'], 'wktgeom' : 'POINT ( 274539 7042095)'}
milinje2d = { 'eg' : [2, 'fin linje'], 'wkt' : 'LINESTRING (274539 7042095, 274539 7042195)'}

#             { 'egenskaper' : [3, 'hehe'], 'wktgeom' : 'POINT ( 274549 7042155)'},
#            { 'egenskaper' : [4, 'fin linje'], 'wktgeom' : 'LINESTRING (274509 7042095, 274509 7042195)'},
mimultilinje2d = { 'eg' : [5, 'Ekte fartsgrense'], 'wkt' : mywkt }
mittpunkt3d =  { 'egenskaper' : [3, 'hehe'], 'wktgeom' : 'POINT Z( 274529 7042165 100)'}

#feat1 = QgsFeature()
#feat1.setAttributes( mittpunkt2d['egenskaper'])
#feat1.setGeometry( QgsGeometry.fromWkt(mittpunkt2d['wktgeom']))
#
#feat3d = QgsFeature()
#feat3d.setAttributes( mittpunkt3d['egenskaper'])
#my3dgeom = QgsGeometry.fromWkt(mittpunkt3d['wktgeom'])
#my2dgeom = QgsGeometry.fromPointXY( my3dgeom.asPoint())
#
#feat3d.setGeometry(my2dgeom)
#egenskapdef = 'field=id:integer&field=description:string'
#punktlag = QgsVectorLayer('Point' + '?crs=epsg:25833&index=yes&' + egenskapdef, 'punktlag', 'memory')
#
#QgsProject.instance().addMapLayer(punktlag)
#punktlag.startEditing()  
#r = punktlag.addFeature( feat1)
#r3d = punktlag.addFeature( feat3d)
#punktlag.commitChanges()
#
#####################
# from nvdb2qgis3 import mytest, nvdb2kart, memlayerwrap
from nvdbapi import nvdbFagdata, nvdbVegnett
from nvdb2qgis3 import qgisdakat, egenskaptype2qgis 
# nvdb2kart( [ mittpunkt3d, mittpunkt2d])
b = nvdbFagdata(45)
(egIds, qgisEg) = qgisdakat(b)
